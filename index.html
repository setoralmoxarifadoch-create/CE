<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ALMOXARIFADO INTELLIGENT V9.2 - CHIAVARI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.23/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
    <style>
        /* === IN√çCIO DA ESTILIZA√á√ÉO (NOVO VISUAL DARK & 13px) === */
        :root { 
            --vinho: #4d0011; 
            --vinho-claro: #f43f5e; /* Usado para textos no fundo escuro */
            --bg-dark: #0f172a; /* Fundo principal */
            --card-dark: #1e293b; /* Fundo dos pain√©is */
            --border-dark: #334155; 
        }
        
        body { 
            background-color: var(--bg-dark); 
            color: #e2e8f0; 
            font-family: 'Inter', sans-serif; 
            font-size: 13px; /* Nova fonte base solicitada */
            -webkit-user-select: none; 
            user-select: none; 
        }
        
        .bg-vinho { background-color: var(--vinho); }
        .text-vinho { color: var(--vinho-claro); }
        
        .status-vermelho { background: #e11d48; color: white; padding: 2px 8px; border-radius: 4px; font-weight: bold; animation: pulse 1.5s infinite; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }
        
        /* Ajuste dos Cards para o Dark Mode */
        .card-dash { background: var(--card-dark); padding: 12px 16px; border-radius: 12px; border-bottom: 3px solid var(--vinho-claro); box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3); }
        
        .search-results { position: absolute; z-index: 100; width: 100%; background: var(--card-dark); border: 1px solid var(--border-dark); max-height: 200px; overflow-y: auto; border-radius: 8px; box-shadow: 0 10px 15px rgba(0,0,0,0.5); }
        
        .signature { position: fixed; bottom: 5px; right: 10px; font-size: 9px; color: #475569; font-weight: bold; letter-spacing: 1px; pointer-events: none; }
        .hidden { display: none; }
        
        .pendencia-card { border-left: 3px solid #e11d48; background: #2e1017; color: #f8fafc; }
        .text-valor { color: #22c55e; font-family: 'Courier New', monospace; font-weight: bold; }

        /* For√ßando inputs para o tema escuro */
        input, select { background-color: #0b1120 !important; color: #f8fafc !important; border-color: var(--border-dark) !important; color-scheme: dark; }
        input::placeholder { color: #64748b !important; }
        /* === FIM DA ESTILIZA√á√ÉO === */
    </style>
</head>
<body oncontextmenu="return false;">

<div id="login-screen" class="fixed inset-0 z-[100] flex items-center justify-center" style="background: radial-gradient(circle, #1e293b 0%, #0f172a 100%);">
    <div class="bg-slate-800 p-8 rounded-2xl shadow-2xl w-80 text-center border border-slate-700">
        <div class="w-16 h-16 mx-auto mb-4 bg-vinho rounded-full flex items-center justify-center border-2 border-slate-600 shadow-lg text-2xl">üì¶</div>
        <h2 class="text-white font-black text-2xl mb-1 uppercase italic">Master V9.2</h2>
        <p class="text-slate-500 text-[10px] mb-6 font-bold text-center tracking-widest">PRODUCED BY J GUILHERME</p>
        <input type="password" id="pin-input" placeholder="DIGITE O PIN" class="w-full border p-3 mb-4 text-center text-xl outline-none rounded-xl focus:border-red-500 transition-all shadow-inner">
        <button onclick="autenticar()" class="w-full bg-vinho text-white p-3 rounded-xl font-black uppercase tracking-widest hover:brightness-125 transition">Acessar Sistema</button>
    </div>
</div>

<div id="app" class="hidden max-w-[95%] mx-auto pb-16 pt-4">
    
    <div class="relative w-full h-40 md:h-56 rounded-2xl overflow-hidden shadow-xl mb-6 border border-slate-700">
        <img src="https://images.unsplash.com/photo-1586528116311-ad8dd3c8310d?q=80&w=2070&auto=format&fit=crop" alt="Capa do Sistema" class="w-full h-full object-cover opacity-40">
        
        <div class="absolute inset-0 bg-gradient-to-t from-[#0f172a] via-transparent to-transparent"></div>
        
        <div class="absolute bottom-4 left-6 flex items-end gap-4">
            <div class="w-20 h-20 md:w-24 md:h-24 rounded-full border-4 border-slate-900 overflow-hidden bg-vinho flex items-center justify-center shadow-2xl">
                <span class="text-3xl md:text-4xl">üõ†Ô∏è</span>
            </div>
            <div class="pb-1">
                <h1 class="text-xl md:text-2xl font-black text-white uppercase italic drop-shadow-md">Almoxarifado Intelligence</h1>
                <p class="text-slate-300 text-[11px] font-bold drop-shadow-md tracking-wider">GEST√ÉO E CONTROLE DE ESTOQUE V9.2</p>
                <p id="clock" class="text-[10px] font-mono opacity-60 text-slate-400 mt-1"></p>
            </div>
        </div>

        <div class="absolute top-4 right-4 flex flex-wrap gap-2 justify-end">
            <button onclick="fazerBackup()" class="bg-blue-600/80 backdrop-blur text-white px-3 py-1.5 rounded-lg font-bold text-[10px] uppercase shadow border border-blue-500 hover:bg-blue-500">üíæ BKP</button>
            <button onclick="document.getElementById('import-f').click()" class="bg-slate-600/80 backdrop-blur text-white px-3 py-1.5 rounded-lg font-bold text-[10px] uppercase italic shadow border border-slate-500 hover:bg-slate-500">Restaurar</button>
            <input type="file" id="import-f" onchange="importarBackup(event)" class="hidden">
        </div>
    </div>

    <div class="bg-slate-800 p-3 rounded-xl mb-6 flex flex-wrap items-center gap-3 border border-slate-700 shadow-md">
        <span class="text-[10px] font-bold uppercase text-slate-400">Exportar Relat√≥rios:</span>
        <input type="date" id="filtro-inicio" class="text-xs p-1.5 rounded-lg border-none">
        <span class="text-slate-500 text-xs">at√©</span>
        <input type="date" id="filtro-fim" class="text-xs p-1.5 rounded-lg border-none">
        <button onclick="gerarRelatorioSetorGrafico()" class="bg-slate-700 text-white px-3 py-1.5 rounded-lg font-bold text-[10px] uppercase shadow hover:bg-slate-600 border border-slate-600">üìä Balan√ßo</button>
        <button onclick="gerarRelatorioAluguel()" class="bg-amber-600 text-white px-3 py-1.5 rounded-lg font-bold text-[10px] uppercase shadow hover:bg-amber-500 border border-amber-500">ü§ù Alugu√©is</button>
    </div>

    <div id="painel-pendencias" class="mb-6 hidden">
        <h3 class="font-black text-red-500 mb-2 text-xs uppercase italic flex items-center gap-2">‚ö†Ô∏è Ferramentas em Uso</h3>
        <div id="lista-pendencias" class="grid grid-cols-1 md:grid-cols-4 gap-3"></div>
    </div>

    <div class="grid grid-cols-2 md:grid-cols-4 gap-3 mb-6">
        <div class="card-dash">
            <p class="text-slate-400 text-[9px] font-black uppercase">Reposi√ß√£o Urgente</p>
            <h2 id="dash-criticos" class="text-2xl font-black text-red-500">0</h2>
        </div>
        <div class="card-dash">
            <p class="text-slate-400 text-[9px] font-black uppercase">Movimentos (7d)</p>
            <h2 id="dash-saidas" class="text-2xl font-black text-blue-500">0</h2>
        </div>
        <div class="card-dash">
            <p class="text-slate-400 text-[9px] font-black uppercase">Total em Pe√ßas</p>
            <h2 id="dash-total" class="text-2xl font-black text-green-500">0</h2>
        </div>
        <div class="card-dash">
            <p class="text-slate-400 text-[9px] font-black uppercase">Alugu√©is Ativos</p>
            <h2 id="dash-aluguel" class="text-2xl font-black text-amber-500">0</h2>
        </div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-12 gap-4">
        
        <div class="lg:col-span-4 space-y-4">
            
            <div class="bg-slate-800 p-4 rounded-xl shadow-md border border-slate-700">
                <h3 id="form-title" class="font-black text-vinho mb-3 text-[11px] uppercase italic">üìù Gest√£o de Produto</h3>
                <input type="hidden" id="edit-id">
                <input type="text" id="p-nome" placeholder="NOME DO MATERIAL" class="w-full border p-2 rounded-lg mb-2 outline-none uppercase font-bold text-xs">
                <div class="grid grid-cols-2 gap-2 mb-2">
                    <select id="p-tipo" class="border p-2 rounded-lg text-xs font-bold uppercase">
                        <option value="Insumo">Insumo (üì¶)</option>
                        <option value="Ferramenta">Ferramenta (üõ†Ô∏è)</option>
                    </select>
                    <input type="number" id="p-min" placeholder="Min" class="border p-2 rounded-lg text-center font-bold text-xs">
                </div>
                <div id="div-qtd-inicial" class="mb-2">
                    <input type="number" id="p-qtd" placeholder="Qtd Inicial" class="w-full border p-2 rounded-lg text-center font-bold text-sm">
                </div>
                <div id="div-valor-prod" class="mb-3">
                    <input type="number" step="0.01" id="p-valor" placeholder="Valor Un (R$)" class="w-full border p-2 rounded-lg text-center font-bold text-sm text-green-500">
                </div>
                <div class="flex gap-2">
                    <button onclick="salvarProduto()" id="btn-salvar" class="flex-1 bg-vinho text-white p-2 rounded-lg font-black uppercase text-[10px]">Salvar</button>
                    <button onclick="cancelarEdicao()" id="btn-cancelar" class="hidden bg-slate-600 text-white px-4 rounded-lg font-black text-xs">X</button>
                </div>
            </div>

            <div class="bg-slate-800 p-4 rounded-xl shadow-md border-t-4 border-vinho">
                <h3 class="font-black text-vinho mb-3 text-[11px] uppercase italic">‚ö° Registrar Movimento</h3>
                <div class="relative">
                    <input type="text" id="m-busca-item" onkeyup="buscarItemMovimento(this.value)" placeholder="üîç BUSCAR ITEM..." class="w-full border p-3 rounded-lg font-black outline-none mb-2 focus:border-vinho text-xs">
                    <div id="lista-busca" class="search-results hidden"></div>
                </div>
                <input type="hidden" id="m-id-selecionado">
                <div class="grid grid-cols-2 gap-2 mb-2">
                    <select id="m-op" class="border p-2 rounded-lg font-black uppercase text-xs text-vinho">
                        <option value="saida">Sa√≠da (-)</option>
                        <option value="entrada">Entrada (+)</option>
                    </select>
                    <input type="number" id="m-qtd" placeholder="Qtd" class="border p-2 rounded-lg font-black text-center text-sm text-vinho">
                </div>
                <div class="mb-2">
                    <input type="number" step="0.01" id="m-valor-mov" placeholder="Valor Op (R$) Opcional" class="w-full border p-2 rounded-lg font-black text-center text-xs text-green-500">
                </div>
                <input type="text" id="m-nome" placeholder="RESPONS√ÅVEL" class="w-full border p-2 rounded-lg mb-2 uppercase text-xs font-bold">
                <select id="m-setor" class="w-full border p-2 rounded-lg mb-3 text-xs font-bold uppercase"></select>
                <button onclick="executarMovimento()" class="w-full bg-green-600 text-white p-3 rounded-lg font-black uppercase shadow hover:bg-green-500 transition text-[11px]">Confirmar</button>
            </div>

            <div class="bg-slate-800 p-4 rounded-xl shadow-md border border-slate-700">
                <h3 class="font-black text-slate-400 mb-3 text-[11px] uppercase italic">‚öôÔ∏è Setores</h3>
                <div class="flex gap-2 mb-3">
                    <input type="text" id="novo-setor" placeholder="NOVO SETOR..." class="flex-1 border p-1.5 rounded-lg uppercase text-[10px] font-bold">
                    <button onclick="adicionarSetor()" class="bg-slate-600 text-white px-3 rounded-lg font-bold">+</button>
                </div>
                <div id="lista-setores-badges" class="flex flex-wrap gap-1"></div>
            </div>

            <div class="bg-slate-800 p-4 rounded-xl shadow-md border border-amber-900/50">
                <h3 class="font-black text-amber-500 mb-3 text-[11px] uppercase italic">ü§ù Alugu√©is</h3>
                <div class="space-y-2 mb-3">
                    <input type="text" id="aluguel-item" placeholder="EQUIPAMENTO" class="w-full border p-2 rounded-lg text-[10px] uppercase font-bold">
                    <div class="grid grid-cols-2 gap-2">
                        <input type="date" id="aluguel-data" class="border p-2 rounded-lg text-[10px]">
                        <input type="text" id="aluguel-fornecedor" placeholder="FORNECEDOR" class="border p-2 rounded-lg text-[10px] uppercase font-bold">
                    </div>
                    <input type="number" step="0.01" id="aluguel-valor" placeholder="R$ ALUGUEL" class="w-full border p-2 rounded-lg text-[10px] uppercase font-bold">
                    <button onclick="registrarAluguel()" class="w-full bg-amber-600 text-white p-2 rounded-lg font-black text-[10px] uppercase">Registrar</button>
                </div>
                <div id="lista-alugueis" class="space-y-2"></div>
            </div>

            <div class="bg-slate-800 p-4 rounded-xl shadow-md border border-slate-700">
                 <h3 class="font-black text-vinho mb-3 text-[11px] uppercase italic">‚ö° Atividades Recentes</h3>
                 <div id="historico-lista" class="space-y-1"></div>
            </div>
        </div>

        <div class="lg:col-span-8">
            <div class="bg-slate-800 rounded-xl shadow-md border border-slate-700 overflow-hidden sticky top-4">
                <div class="p-4 border-b border-slate-700 bg-slate-800/50">
                    <h3 class="font-black text-vinho text-[11px] uppercase italic mb-2">üì¶ Monitor de Estoque</h3>
                    <input type="text" id="busca-geral" onkeyup="render()" placeholder="üîç BUSCAR NO ESTOQUE..." class="w-full bg-slate-900 p-3 rounded-lg outline-none font-bold text-slate-200 border border-slate-600 text-xs">
                </div>
                <div class="overflow-x-auto px-2 pb-2">
                    <table class="w-full text-left">
                        <thead>
                            <tr class="text-[9px] uppercase text-slate-500 font-black tracking-widest border-b border-slate-700">
                                <th class="p-3">Material</th>
                                <th class="p-3 text-center">Saldo</th>
                                <th class="p-3 text-center">Status</th>
                                <th class="p-3 text-right">A√ß√£o</th>
                            </tr>
                        </thead>
                        <tbody id="lista-corpo"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="signature italic">Produced by J Guilherme A.C. | V9.2 Dark Edition</div>

<div style="position: absolute; left: -9999px;">
    <canvas id="canvasSetor" width="400" height="400"></canvas>
    <canvas id="canvasFunc" width="400" height="400"></canvas>
</div>

